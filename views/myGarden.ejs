<!DOCTYPE html>
<html>
<head>
  <title>My Garden</title>
  <link rel="stylesheet" href="/css/styles.css" type="text/css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">

    <!--For comparing if today's date is in optimal planting range for a plant-->
  <%
  function isDateInRange(today, start, end) {
    if (!start || !end) return false;
    return (start <= end && today >= start && today <= end) ||
           (start > end && (today >= start || today <= end));
    }
  %>

</head>
<body style="flex-direction: column;">
    <div class="navbar">
        <a class="active" href="/">My Garden</a>
        <a href="/addPlants">Add Plants</a>
        <a class="profile">Profile</a>
    </div>
    <div style="display: flex; flex-direction:column; justify-content: center;align-items: center; margin: 0;">
        <h1>Welcome, <%= user.name || user.email %>!</h1>

        <form action="/logout" method="GET">
            <button type="submit">Logout</button>
        </form>

        <% if (user.userGarden) { %>
            <h4>Planted</h4>
            <table>
            <thead>
                <tr>
                <th>Name</th>
                <th>Date Planted</th>
                <th>Approx Harvest</th>
                <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                <% for (let i = 0; i < user.userGarden.length; i++) { 
                    const data = user.userGarden[i]; 
                    //Compares today's date to plant range to change bg color
                    if (data.datePlanted !== "0") { 
                    %>
                <tr>
                    <td><%= data.name %></td>
                    <td><%= data.datePlanted || "—" %></td>
                    <td><%= plantingData[data.name].maturityTime || "—" %></td>
                    <td>
                        <form action="/removePlant" method="POST">
                        <input type="hidden" name="name" value="<%= data.name %>">
                        <input type="hidden" name="datePlanted" value="<%= data.datePlanted %>">
                        <button type="submit">Delete</button>
                    </form></td>
                </tr>
                <% }} %>
            </tbody>
            </table>
        <% } else { %>
            <p>Please add plants to your garden</p>
        <% } %>

        <% if (user.userGarden) { %>
            
            <table>
                <h4>Upcoming</h4>
            <thead>
                <tr>
                <th>Name</th>
                <th>Approx Harvest Time</th>
                <th>Plant!</th>
                <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                <% for (let i = 0; i < user.userGarden.length; i++) { 
                    const data = user.userGarden[i]; 
                    //Compares today's date to plant range to change bg color
                    const inSpringRange = isDateInRange(dateToday, plantingData[data.name].plantOutdoorsStart, plantingData[data.name].plantOutdoorsEnd);
                    const inFallRange = isDateInRange(dateToday, plantingData[data.name].plantOutdoorsStartFall, plantingData[data.name].plantOutdoorsEndFall);
                    const inSeason = inSpringRange || inFallRange;
                    if (data.datePlanted == "0") { 
                    %>
                <tr style="<%= inSeason ? 'background-color: #ccf3ba; color: black;' : '' %>">
                    <td><%= data.name %></td>
                    <td><%= plantingData[data.name].maturityTime || "—" %></td>
                    <td>
                        <form action="/plantFromUpcoming" method="POST">
                        <input type="hidden" name="name" value="<%= data.name %>">
                        <input type="hidden" name="datePlanted" value="<%= data.datePlanted %>">
                        <button type="submit">Plant</button>
                    </form>
                    </td>
                    <td>
                        <form action="/removePlant" method="POST">
                        <input type="hidden" name="name" value="<%= data.name %>">
                        <input type="hidden" name="datePlanted" value="<%= data.datePlanted %>">
                        <button type="submit">Delete</button>
                    </form>
                    </td>
                </tr>
                <% }} %>
            </tbody>
            </table>
            <% } %>
    </div>
    
      </body>
      </html>
    
</body>
</html>