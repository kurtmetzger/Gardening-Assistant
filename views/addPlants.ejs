<!DOCTYPE html>
<html>
<head>
  <title>Add Plants</title>
  <link rel="stylesheet" href="/css/styles.css" type="text/css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  
  <!--For comparing if today's date is in optimal planting range for a plant-->
  <%
  function isDateInRange(today, start, end) {
    if (!start || !end) return false;
    return (start <= end && today >= start && today <= end) ||
           (start > end && (today >= start || today <= end));
    }
  %>
</head>
<body style="flex-direction: column;">
    <div class="navbar">
        <a href="/">My Garden</a>
        <a class="active" href="/addPlants">Add Plants</a>
        <a class="profile">Profile</a>
    </div>
    <h1>Showing plants for planting zone, <%= user.plantingZone %>!</h1>

    <form action="/logout" method="GET">
        <button type="submit">Logout</button>
    </form>


    <!-- Zone Modal -->
    <% if (user && user.plantingZone === "0") { %>
      <div>
        <form action="/setZone" method="POST" class="modal-content">
            <h5 class="modal-title" id="zoneModalLabel">Enter Your ZIP Code</h5>
            <p>This lets us determine your Plant Hardiness zone. Only your zone, not your zipcode, is saved.</p>
            <input type="text" name="zipcode" class="form-control" placeholder="e.g. 60601" required pattern="\d{5}">
            <button type="submit" class="btn btn-primary">Save ZIP Code</button>
        </form>
      </div>
    <% } %>
  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<% if (user.plantingZone !== "0") { %>
  <table>
    <thead>
      <tr>
        <th>Plant</th>
        <th>Spring Start</th>
        <th>Spring End</th>
        <th>Fall Start</th>
        <th>Fall End</th>
        <th>Days to Maturity</th>
        <th>Add</th>
      </tr>
    </thead>
    <tbody>
      <% for (let plant in plantingData) { 
          const data = plantingData[plant]; 
          //Compares today's date to plant range to change bg color
          const inSpringRange = isDateInRange(dateToday, data.plantOutdoorsStart, data.plantOutdoorsEnd);
          const inFallRange = isDateInRange(dateToday, data.plantOutdoorsStartFall, data.plantOutdoorsEndFall);
          const inSeason = inSpringRange || inFallRange;
          %>
          
        <tr style="<%= inSeason ? 'background-color: #ccf3ba; color: black;' : '' %>">
          <td><%= plant %></td>
          <td><%= data.plantOutdoorsStart || "—" %></td>
          <td><%= data.plantOutdoorsEnd || "—" %></td>
          <td><%= data.plantOutdoorsStartFall || "—" %></td>
          <td><%= data.plantOutdoorsEndFall || "—" %></td>
          <td><%= data.maturityTime || "—" %></td>
          <td>
            <form action="/addToGarden" method="POST">
              <input type="date" name="datePlanted" value="<%= new Date().toISOString().slice(0, 10) %>">
              <input type="hidden" name="name" value="<%= plant %>">
              <button type="submit">Add Plant</button>
            </form>
          </td>
        </tr>
      <% } %>
    </tbody>
  </table>
<% } else { %>
  <p>Please enter your zip code to get planting information for your zone.</p>
<% } %>
    
</body>
</html>